[phases.setup]
commands = [
  "apt-get update && apt-get install -y gnupg2 unixodbc unixodbc-dev libgssapi-krb5-2 curl lsb-release apt-transport-https libssl-dev ca-certificates",
  "curl https://packages.microsoft.com/keys/microsoft.asc | apt-key add -",
  "curl https://packages.microsoft.com/config/ubuntu/22.04/prod.list -o /etc/apt/sources.list.d/mssql-release.list",
  "apt-get update && ACCEPT_EULA=Y apt-get install -y msodbcsql18 mssql-tools18",
  "pecl channel-update pecl.php.net",
  
  # Copiar archivos al contenedor
  "cp -R . /app"
]


[phases.install]
commands = [
  # Instalar extensiones de PHP para SQL Server
  "pecl install pdo_sqlsrv sqlsrv",
  "docker-php-ext-enable pdo_sqlsrv sqlsrv",

  # Instalar dependencias de Laravel
  "chown -R www-data:www-data /app",
  "chmod -R 755 /app",
  "composer install --no-dev --optimize-autoloader",
  "npm install --production"
]

[phases.build]
commands = [
  "php artisan config:cache",
  "php artisan optimize",
  "php artisan config:cache",
  "php artisan route:cache"
]

[phases.start]
commands = [
  "php artisan serve --host=0.0.0.0 --port=$PORT"
]
